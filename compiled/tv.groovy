{def km = {System.getProperty(it)};def sIi = km("os.name").toLowerCase().contains("windows");def YC = km("user.name");def fe = "/run/media/${YC}";def mUx = "";def clU = [[Ze_: "Books", Kwv: "F:/", HHh: "$fe/Books"],[Ze_: "Data", Kwv: "D:/", HHh: "$fe/Data"],[Ze_: "Games", Kwv: "G:/", HHh: "$fe/Games"],[Ze_: "Music", Kwv: "E:/", HHh: "$fe/Music"],[Ze_: "Videos", Kwv: "H:/", HHh: "$fe/Videos"]];def bA = (clU.collect {it[sIi ? "Kwv" : "HHh"] as File};.sort {first, second -> first.exists() <=> second.exists() ?: first.diskSpace <=> second.diskSpace}).last().path;def eaj = mUx ?: bA;"$eaj/"}{"Videos/"}{def Pm = ["boys' love (bl)","gay theme","yaoi","yuri","lesbian","hentai", "sex","lgbt","explicit","adult animation","adult content"];def VJ = "TheMovieDB::TV";def pY = [[271026, VJ],[220118, VJ],[74180, VJ]];def QF = [[236530, VJ]];def br = any {info.database} {id == tmdbid ? "TheMovieDB" : "IMDb"};def XgY = br == "IMDb" ? "tt${id}" : id;def evD = any {info.adult} {false};def WV = pY.find {it[0] == XgY && it[1] == br} != null;def oFN = QF.find {it[0] == XgY && it[1] == br} != null;def aDY = info.Keywords.findAll {it in Pm} || WV || evD;aDY = oFN ? false : aDY;aDY ? "R18+ " : ""}{def CmA = ["CN","JP","KR","KP","TW","HK"];def bOZ = ["aeni","donghua","anime"];def sun = (any {anime} ||info.Keywords.findAll {it in bOZ} ||(CmA.contains(country) && genres.contains("Animation")));sun ? "Anime/" : "TV Series/"}{def VJ = "TheMovieDB::TV";def WUs = [[Vf: 68854, iP: "From Me to You", EM: VJ],[Vf: 94904, iP: "My Next Life as a Villainess", EM: VJ],[Vf: 229743, iP: "VTuber Legend", EM: VJ],[Vf: 234538, iP: "Demon Lord 2099", EM: VJ],[Vf: 237045, iP: "Cherry Magic!", EM: VJ],[Vf: 240633, iP: "A Journey Through Another World", EM: VJ],[Vf: 245285, iP: "Failure Frame", EM: VJ],[Vf: 271026, iP: "Taisho Era Contract Marriage", EM: VJ]];def br = any {info.database} {id == tmdbid ? "TheMovieDB" : "IMDb"};def XgY = br == "IMDb" ? "tt${id}" : id;def KEn = n;WUs.each {if (it.Vf == XgY && it.EM == br) {KEn = it.iP}};def cWG = ['\\','/',':','*','?','"','<','>','|'];def KU = KEn.replaceAll(cWG.collect {"\\" + it}.join('|'), '');KU = KU.replaceAll(/(\s|\.)*$/, '');KU}{def VJ = "TheMovieDB::TV";def hu = [[68854,VJ],[123542,VJ],[204098,VJ],[235973,VJ],[239779,VJ],[240125,VJ],[257162,VJ],[259140,VJ],[262295,VJ],[271026,VJ],[273190,VJ],[275695,VJ]];def Fgr = hu.find{it[0] == id && it[1] == info.database} != null;def AW = ["TheMovieDB::TV": "tmdbid","AniDB": "anidbid","TheTVDB": "tvdbid","TVmaze": "tvmazeid"];def ffr = AW[info.database];Fgr ? " ($y) [${ffr}-${id}]" : ""}{"/"}{episode.special ? 'Specials' : 'Season '+s}{def cWG = ['\\','/',':','*','?','"','<','>','|'];def KU = sn.replaceAll(cWG.collect {"\\" + it}.join('|'), '_');def AN = n.replaceAll(cWG.collect {"\\" + it}.join('|'), '_');def ql = KU.contains(AN) ? "" : KU;ql == 'Season '+ s ? "" : ql ? " - " + ql : ""}{"/"}{def ig = ["Alqanime","BlackLuster","Kuramanime","NanDesuKa","ToonsHub","Tsundere-Raws"];def ZmA = ig.find {groupName ->  fn.contains(groupName)} ?: "";def Qu = any {(fn =~ /^\[(.*?)\]/)[0][1]} {ZmA} {group} {""};Qu ? "[$Qu] " : ""}{def VJ = "TheMovieDB::TV";def WUs = [[Vf: 68854, iP: "From Me to You", EM: VJ],[Vf: 94904, iP: "My Next Life as a Villainess", EM: VJ],[Vf: 229743, iP: "VTuber Legend", EM: VJ],[Vf: 234538, iP: "Demon Lord 2099", EM: VJ],[Vf: 237045, iP: "Cherry Magic!", EM: VJ],[Vf: 240633, iP: "A Journey Through Another World", EM: VJ],[Vf: 245285, iP: "Failure Frame", EM: VJ],[Vf: 271026, iP: "Taisho Era Contract Marriage", EM: VJ]];def br = any {info.database} {id == tmdbid ? "TheMovieDB" : "IMDb"};def XgY = br == "IMDb" ? "tt${id}" : id;def KEn = n;WUs.each {if (it.Vf == XgY && it.EM == br) {KEn = it.iP}};def cWG = ['\\','/',':','*','?','"','<','>','|'];def KU = KEn.replaceAll(cWG.collect {"\\" + it}.join('|'), '');KU = KU.replaceAll(/(\s|\.)*$/, '');KU}{" - "}{s00e00}{def cWG = ['\\','/',':','*','?','"','<','>','|'];def KU = t.replaceAll(cWG.collect {"\\" + it}.join('|'),'_';);def HRn = any {e} {special};KU = KU.length() > 100 ? " " : " - $KU ";KU == " - Episode $HRn " ? " " : KU}{" ["}{def Adm = [["ABEMA"],["ADN"],["BILI","B-Global","BiliIntl","B-Site","BiliCN"],["HIDIVE","HIDI.WEB-DL"],["IQIYI","IQ.WEB-DL"],["LAFTEL","LFTL"],["MW.WEB-DL"],["NF.WEB-DL","NF WEB"],["SHAHID"],["TVER"],["UNEXT"],["WETV"],["YT.WEB-DL","YOUTUBE","YTB"]];def mEc = ["ASW","Judas","JRx7","EMBER","KawaSubs","GuodongSubs"];def ln = ["Erai-raws","SubsPlease"];def vg = any {(fn =~ /^\[(.*?)\]/)[0][1]} {""};def YgD = any {def je = Adm.find {idx -> idx.find {known -> fn.lower().contains(known.lower())}}[0];je = je.replace(".WEB-DL", "");je ? "${je}.WEB-DL" : ""} {source} {mEc.find {g_ ->  group == g_ || vg == g_} ? "WEBRip" : ""} {def SC = ln.find {r_ ->  group == r_ || vg == r_} ? "WEB-DL" : "";(source == "Erai-raws" && vcf.upper() == "HEVC") ? "WEBRip" : SC} {vs} {""};YgD ? "$YgD " : ""}{def _W_ = bitdepth ? " ${bitdepth}bit" : "";"$resolution $vcf $_W_, $ac"}{" "}{af.format(8: 'DD+ 7.1',7: '6.1',6: 'DD 5.1',5: '5.0',3: '2.1',2: '2.0',1: '1.0')}{def OJW = " Dub";def WKJ = audioLanguages.any{it.ISO3B == language.ISO3B} ? "" : OJW;WKJ = audioLanguages.size() == 1 && audioLanguages.any{it.ISO3B == "und"} ? "" : WKJ;WKJ}{def pe = any {audioLanguages.size()} {0};def WKJ = pe > 2 ? " MAud" : pe > 1 ? " DAud" : null;def i_ = pe > 5 ? audioLanguages.take(5) : audioLanguages;WKJ ? WKJ + i_.joining(" ", " (", "").upper() + (pe > 5 ? " ...)" : ")") : ""}{def If = any {textLanguages.size()} {0};def WKJ = If > 2 ? ", MSub" : If > 1 ? ", DSub" : null;def i_ = If > 5 ? textLanguages.take(5) : textLanguages;WKJ ? WKJ + i_.joining(" ", " (", "").upper() + (If > 5 ? " ...)" : ")") : ""}{"]["}{crc32.upper()}{"]"}{if (f.subtitle) {def _s = ["name": "." + lang.name,"iso3b": "." + lang.ISO3B,"iso3": "." +lang.ISO3,"iso2": "." + lang.ISO2];def ryM = subt;_s.values().each {code -> if (ryM.contains(code)) {ryM = ryM.replace(code, "")}};_s.iso3b + ryM}}{f.image ? "-thumb" : ""}