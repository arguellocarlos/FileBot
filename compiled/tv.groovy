{def aq = { System.getProperty(it) };def ah = aq("os.name").toLowerCase().contains("windows");def QRg = aq("user.name");def Fm = "/run/media/${QRg}";def JRf = ah ? "H:/" : "$Fm/Videos";def QdS = [[Ro: "Books", yQJ: "F:/", PVp: "$Fm/Books"],[Ro: "Data", yQJ: "D:/", PVp: "$Fm/Data"],[Ro: "Games", yQJ: "G:/", PVp: "$Fm/Games"],[Ro: "Music", yQJ: "E:/", PVp: "$Fm/Music"],[Ro: "Videos", yQJ: "H:/", PVp: "$Fm/Videos"]];def vfC = (QdS.collect { it[ah ? "yQJ" : "PVp"] as File }.sort { ZYv, ZX ->  ZYv.exists() <=> ZX.exists() ?: ZYv.diskSpace <=> ZX.diskSpace }).last();def Ph = JRf ?: vfC;"$Ph/"}{"Videos/"}{def Qab = ["boys' love (bl)", "gay theme", "yaoi", "yuri", "lesbian", "hentai","sex", "lgbt", "explicit", "adult animation", "adult content"];def Fx = "TheMovieDB::TV";def Ef = [[271026, Fx],[220118, Fx],[ 74180, Fx]];def sq = [[236530, Fx]];def mYJ = any { info.database } { id == tmdbid ? "TheMovieDB" : "IMDb" };def dRH = mYJ == "IMDb" ? "tt${id}" : id;def Sa = any { info.adult } { false };def oR = Ef.find { it[0] == dRH && it[1] == mYJ } != null;def PeU = sq.find { it[0] == dRH && it[1] == mYJ } != null;def HD = info.Keywords.findAll { it in Qab } || oR || Sa;HD = PeU ? false : HD;HD ? "R18+ " : ""}{def MY = ["CN", "JP", "KR", "KP", "TW", "HK"];def sVF = ["aeni", "donghua", "anime"];def Alu = any {anime} || info.Keywords.findAll { it in sVF } || (MY.contains(country) && genres =~ /Animation/);Alu ? "Anime/" : "TV Series/"}{def Fx = "TheMovieDB::TV";def CEE = [[SD: 68854, ehs: "From Me to You", BK: Fx],[SD: 94904, ehs: "My Next Life as a Villainess", BK: Fx],[SD: 229743, ehs: "VTuber Legend", BK: Fx],[SD: 234538, ehs: "Demon Lord 2099", BK: Fx],[SD: 237045, ehs: "Cherry Magic!", BK: Fx],[SD: 240633, ehs: "A Journey Through Another World", BK: Fx],[SD: 245285, ehs: "Failure Frame", BK: Fx],[SD: 271026, ehs: "Taisho Era Contract Marriage", BK: Fx]];def mYJ = any { info.database } { id == tmdbid ? "TheMovieDB" : "IMDb" };def dRH = mYJ == "IMDb" ? "tt${id}" : id;def Xr = n;CEE.each {if (it.SD == dRH && it.BK == mYJ) {Xr = it.ehs}};def bxE = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def Hk = Xr.replaceAll(bxE.collect { "\\" + it }.join('|'), '');Hk = Hk.replaceAll(/(\s|\.)*$/, '');Hk}{def Fx = "TheMovieDB::TV";def Id = [[ 68854, Fx],[123542, Fx],[204098, Fx],[235973, Fx],[239779, Fx],[240125, Fx],[257162, Fx],[259140, Fx],[262295, Fx],[271026, Fx],[273190, Fx],[275695, Fx]];def zZF = Id.find { it[0] == id && it[1] == info.database } != null;def qN = ["TheMovieDB::TV": "tmdbid","AniDB": "anidbid","TheTVDB": "tvdbid","TVmaze": "tvmazeid"];def Jd = qN[info.database];zZF ? " ($y) [${Jd}-${id}]" : ""}{"/"}{episode.special ? 'Specials' : 'Season '+s}{def bxE = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def Hk = sn.replaceAll(bxE.collect { "\\" + it }.join('|'), '_');def eR = n.replaceAll(bxE.collect { "\\" + it }.join('|'), '_');def TKA = Hk.contains(eR) ? "" : Hk;TKA == 'Season '+ s ? "" : TKA ? " - " + TKA : ""}{"/"}{def eI = ["Alqanime","BlackLuster","NanDesuKa","ToonsHub","Tsundere-Raws"];def gTS = eI.find { Ayq ->  fn.contains(Ayq) } ?: "";def tz = any {(fn =~ /^\[(.*?)\]/)[0][1]} {gTS} {group} {""};tz ? "[$tz] " : ""}{def Fx = "TheMovieDB::TV";def CEE = [[SD: 68854, ehs: "From Me to You", BK: Fx],[SD: 94904, ehs: "My Next Life as a Villainess", BK: Fx],[SD: 229743, ehs: "VTuber Legend", BK: Fx],[SD: 234538, ehs: "Demon Lord 2099", BK: Fx],[SD: 237045, ehs: "Cherry Magic!", BK: Fx],[SD: 240633, ehs: "A Journey Through Another World", BK: Fx],[SD: 245285, ehs: "Failure Frame", BK: Fx],[SD: 271026, ehs: "Taisho Era Contract Marriage", BK: Fx]];def mYJ = any { info.database } { id == tmdbid ? "TheMovieDB" : "IMDb" };def dRH = mYJ == "IMDb" ? "tt${id}" : id;def Xr = n;CEE.each {if (it.SD == dRH && it.BK == mYJ) {Xr = it.ehs}};def bxE = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def Hk = Xr.replaceAll(bxE.collect { "\\" + it }.join('|'), '');Hk = Hk.replaceAll(/(\s|\.)*$/, '');Hk}{" - "}{s00e00}{def bxE = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def Hk = t.replaceAll(bxE.collect { "\\" + it }.join('|'), '_');def cyI = any { e } { special };Hk = Hk.length() > 100 ? " " : " - $Hk ";Hk == " - Episode $cyI " ? " " : Hk}{" ["}{def tt = [["ABEMA"],["BILI", "B-Global", "BiliIntl", "B-Site", "BiliCN"],["HULU"],["IQIYI", "IQ.WEB-DL"],["LAFTEL", "LFTL"],["MW.WEB-DL"],["NF.WEB-DL", "NF WEB"],["AMZN"],["SHAHID"],["TVER"],["UNEXT"],["YT.WEB-DL", "YOUTUBE", "YTB"]];def gX = ["ASW", "Judas", "JRx7", "EMBER", "KawaSubs", "GuodongSubs"];def tk = ["Erai-raws", "SubsPlease"];def UcX = any {(fn =~ /^\[(.*?)\]/)[0][1]} {""};def Qcx = any {def yir = tt.find { YlD ->  YlD.find { eps ->  fn.lower().contains(eps.lower()) } }[0];yir = yir.replace(".WEB-DL", "");yir ? "${yir}.WEB-DL" : ""} {} {source} {gX.find { ncz ->  group == ncz || UcX == ncz } ? "WEBRip" : ""} {def Ytu = tk.find { cL ->  group == cL || UcX == cL} ? "WEB-DL" : "";(source == "Erai-raws" && vcf.upper() == "HEVC") ? "WEBRip" : Ytu} {vs} {""};Qcx ? "$Qcx " : ""}{def oWt = bitdepth ? " ${bitdepth}bit" : "";"$resolution $vcf $oWt, $ac"}{" "}{af.format(8: 'DD+ 7.1',7: '6.1',6: 'DD 5.1',5: '5.0',3: '2.1',2: '2.0',1: '1.0')}{def XtP = " Dub";def kE = audioLanguages.any { it.ISO3B == language.ISO3B } ? "" : XtP;kE = audioLanguages.size() == 1 && audioLanguages.any { it.ISO3B == "und" } ? "" : kE;kE}{def MUA = any { audioLanguages.size() } { 0 };def kE = MUA > 2 ? " MAud" : MUA > 1 ? " DAud" : null;def JrX = MUA > 5 ? audioLanguages.take(5) : audioLanguages;kE ? kE + JrX.joining(" ", " (", "").upper() + (MUA > 5 ? " ...)" : ")") : ""}{def _sK = any { textLanguages.size() } { 0 };def kE = _sK > 2 ? ", MSub" : _sK > 1 ? ", DSub" : null;def JrX = _sK > 5 ? textLanguages.take(5) : textLanguages;kE ? kE + JrX.joining(" ", " (", "").upper() + (_sK > 5 ? " ...)" : ")") : ""}{"]["}{crc32.upper()}{"]"}{if (f.subtitle) {def Jr = ["name": "." + lang.name,"iso3b": "." + lang.ISO3B,"iso3": "." +lang.ISO3,"iso2": "." + lang.ISO2];def QBp = subt;Jr.values().each { QZy -> if (QBp.contains(QZy)) {QBp = QBp.replace(QZy, "")}};Jr.iso3b + QBp}}{f.image ? "-thumb" : ""}