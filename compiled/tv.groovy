{def CZ = { System.getProperty(it) };def oDb = CZ("os.name").toLowerCase().contains("windows");def lDr = CZ("user.name");def XRi = "/run/media/${lDr}";def PbX = oDb ? "H:/" : "$XRi/Videos";def Fn = [[fS: "Books", st: "F:/", FTN: "$XRi/Books"],[fS: "Data", st: "D:/", FTN: "$XRi/Data"],[fS: "Games", st: "G:/", FTN: "$XRi/Games"],[fS: "Music", st: "E:/", FTN: "$XRi/Music"],[fS: "Videos", st: "H:/", FTN: "$XRi/Videos"]];def cgD = (Fn.collect { it[oDb ? "st" : "FTN"] as File }.sort { Be, uJz ->  Be.exists() <=> uJz.exists() ?: Be.diskSpace <=> uJz.diskSpace }).last();def FOX = PbX ?: cgD;"$FOX/"}{"Videos/"}{def Iso = ["boys' love (bl)", "gay theme", "yaoi", "yuri", "lesbian", "hentai","sex", "lgbt", "explicit", "adult animation", "adult content","nudity"];def FY = "TheMovieDB::TV";def QsI = [[ 74180, FY],[ 93821, FY],[ 95897, FY],[220118, FY],[271026, FY]];def IlB = [[236530, FY]];def nkg = any { info.database } { id == tmdbid ? "TheMovieDB" : "IMDb" };def RQ = nkg == "IMDb" ? "tt${id}" : id;def Gr = any { info.adult } { false };def wct = QsI.find { it[0] == RQ && it[1] == nkg } != null;def nAs = IlB.find { it[0] == RQ && it[1] == nkg } != null;def Rf = info.Keywords.findAll { it in Iso } || wct || Gr;Rf = nAs ? false : Rf;Rf ? "R18+ " : ""}{def kW = ["CN", "JP", "KR", "KP", "TW", "HK"];def Pre = ["aeni", "donghua", "anime"];def Rds = any {anime} || info.Keywords.findAll { it in Pre } || (kW.contains(country) && genres =~ /Animation/);Rds ? "Anime/" : "TV Series/"}{def FY = "TheMovieDB::TV";def Dga = [[FI: 68854, hxk: "From Me to You", mIh: FY],[FI: 219816, hxk: "Fate Grand Order Fujimaru Ritsuka Doesn't Get It", mIh: FY],[FI: 245561, hxk: "Okitsura", mIh: FY],[FI: 248707, hxk: "Neko Oji The Guy That Got Reincarnated As a Cat", mIh: FY],[FI: 259559, hxk: "Headhunted to Another World", mIh: FY],[FI: 261301, hxk: "Botsuraku Kizoku", mIh: FY],[FI: 262141, hxk: "Can You Keep a Secret", mIh: FY],[FI: 270657, hxk: "Tono to Inu", mIh: FY],[FI: 276204, hxk: "Bogus Skill Fruitmaster", mIh: FY]];def nkg = any { info.database } { id == tmdbid ? "TheMovieDB" : "IMDb" };def RQ = nkg == "IMDb" ? "tt${id}" : id;def TM = n;Dga.each {if (it.FI == RQ && it.mIh == nkg) {TM = it.hxk}};def bR = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def QN = TM.replaceAll(bR.collect { "\\" + it }.join('|'), '');QN = QN.replaceAll(/(\s|\.)*$/, '');QN}{def FY = "TheMovieDB::TV";def WSu = [[ 95897, FY],[123542, FY],[235973, FY],[239779, FY],[257162, FY],[259140, FY],[276204, FY]];def sB = WSu.find { it[0] == id && it[1] == info.database } != null;def XiA = ["TheMovieDB::TV": "tmdbid","AniDB": "anidbid","TheTVDB": "tvdbid","TVmaze": "tvmazeid"];def Jv = XiA[info.database];sB ? " ($y) [${Jv}-${id}]" : ""}{"/"}{episode.special ? 'Specials' : 'Season '+s}{def bR = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def QN = sn.replaceAll(bR.collect { "\\" + it }.join('|'), '_');def DJL = n.replaceAll(bR.collect { "\\" + it }.join('|'), '_');def uaf = QN.contains(DJL) ? "" : QN;uaf == 'Season '+ s ? "" : uaf ? " - " + uaf : ""}{"/"}{def Qvm = ["Alqanime","BlackLuster","darkflux","Kuramanime","NanDesuKa","ToonsHub","Tsundere-Raws","S1PH3R","Samehadaku"];def xbL = Qvm.find { Oh ->  fn.lower().contains(Oh.lower()) } ?: "";def rWQ = any {(fn =~ /^\[(.*?)\]/)[0][1]} {xbL} {group} {""};rWQ ? "[$rWQ] " : ""}{def FY = "TheMovieDB::TV";def Dga = [[FI: 68854, hxk: "From Me to You", mIh: FY],[FI: 219816, hxk: "Fate Grand Order Fujimaru Ritsuka Doesn't Get It", mIh: FY],[FI: 245561, hxk: "Okitsura", mIh: FY],[FI: 248707, hxk: "Neko Oji The Guy That Got Reincarnated As a Cat", mIh: FY],[FI: 259559, hxk: "Headhunted to Another World", mIh: FY],[FI: 261301, hxk: "Botsuraku Kizoku", mIh: FY],[FI: 262141, hxk: "Can You Keep a Secret", mIh: FY],[FI: 270657, hxk: "Tono to Inu", mIh: FY],[FI: 276204, hxk: "Bogus Skill Fruitmaster", mIh: FY]];def nkg = any { info.database } { id == tmdbid ? "TheMovieDB" : "IMDb" };def RQ = nkg == "IMDb" ? "tt${id}" : id;def TM = n;Dga.each {if (it.FI == RQ && it.mIh == nkg) {TM = it.hxk}};def bR = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def QN = TM.replaceAll(bR.collect { "\\" + it }.join('|'), '');QN = QN.replaceAll(/(\s|\.)*$/, '');QN}{" - "}{s00e00}{def bR = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def QN = t.replaceAll(bR.collect { "\\" + it }.join('|'), '_');QN = QN.length() > 100 ? " " : " - $QN ";def fz = any { e } { special };def puV = "Episode $fz";def v_v = QN.contains(puV) ? '' : QN;v_v != '' ? v_v : ''}{" ["}{def YbZ = [["YTB", "YT.WEB-DL", "YOUTUBE"],["ABEMA"],["ADN"],["BILI", "B-Global", "BiliIntl"],["BSITE", "BILICN"],["COOLMIC"],["HIDIVE", "HIDI.WEB-DL"],["IQIYI", "IQ.WEB-DL"],["JFFP"],["LAFTEL", "LFTL"],["MDON", "MANGADON"],["MW.WEB-DL"],["NF.WEB-DL", "NF WEB"],["SHAHID"],["TVER"],["UNEXT"],["WETV"]];def aTm = ["ASW", "Judas", "JRx7", "EMBER", "GuodongSubs", "SAMEHADAKU"];def hR = ["Erai-raws", "SubsPlease"];def LTD = any {(fn =~ /^\[(.*?)\]/)[0][1]} {""};def JK = any {def xT = YbZ.find { Fh ->  Fh.find { PuJ ->  fn.lower().contains(PuJ.lower()) } }[0];xT = xT.replace(".WEB-DL", "");if (fn.contains("WEBRip")) {xT = xT.replace(".WEBRip", "");xT = xT + ".WEBRip"} else {xT = xT + ".WEB-DL"};xT} {source} {aTm.find { uK ->  group == uK || LTD == uK } ? "WEBRip" : ""} {def Ann = hR.find { lgv ->  group == lgv || LTD == lgv} ? "WEB-DL" : "";(source == "Erai-raws" && vcf.upper() == "HEVC") ? "WEBRip" : Ann} {vs} {""};JK ? "$JK " : ""}{def Nn = bitdepth ? " ${bitdepth}bit" : "";"$resolution $vcf $Nn, $ac"}{" "}{af.format(8: 'DD+ 7.1',7: '6.1',6: 'DD 5.1',5: '5.0',3: '2.1',2: '2.0',1: '1.0')}{def tW = " Dub";def ZNr = audioLanguages.any { it.ISO3B == language.ISO3B } ? "" : tW;ZNr = audioLanguages.size() == 1 && audioLanguages.any { it.ISO3B == "und" } ? "" : ZNr;ZNr}{def fO = any { audioLanguages.size() } { 0 };def ZNr = fO > 2 ? " MAud" : fO > 1 ? " DAud" : null;def oB = fO > 5 ? audioLanguages.take(5) : audioLanguages;ZNr ? ZNr + oB.joining(" ", " (", "").upper() + (fO > 5 ? " ...)" : ")") : ""}{def x_s = any { textLanguages.size() } { 0 };def ZNr = x_s > 2 ? ", MSub" : x_s > 1 ? ", DSub" : null;def oB = x_s > 5 ? textLanguages.take(5) : textLanguages;ZNr ? ZNr + oB.joining(" ", " (", "").upper() + (x_s > 5 ? " ...)" : ")") : ""}{"]["}{crc32.upper()}{"]"}{if (f.subtitle) {def fc = ["name": "." + lang.name,"iso3b": "." + lang.ISO3B,"iso3": "." +lang.ISO3,"iso2": "." + lang.ISO2];def wS = subt;fc.values().each { YL -> if (wS.contains(YL)) {wS = wS.replace(YL, "")}};fc.iso3b + wS}}{f.image ? "-thumb" : ""}