{def dz = { System.getProperty(it) };def jIX = dz("os.name").toLowerCase().contains("windows");def xHz = dz("user.name");def dr = "/run/media/${xHz}";def oB = jIX ? "H:/" : "$dr/Videos";def oXx = [[qi: "Books", LI: "F:/", ue: "$dr/Books"],[qi: "Data", LI: "D:/", ue: "$dr/Data"],[qi: "Games", LI: "G:/", ue: "$dr/Games"],[qi: "Music", LI: "E:/", ue: "$dr/Music"],[qi: "Videos", LI: "H:/", ue: "$dr/Videos"]];def Zov = (oXx.collect { it[jIX ? "LI" : "ue"] as File }.sort { IY, kgM ->  IY.exists() <=> kgM.exists() ?: IY.diskSpace <=> kgM.diskSpace }).last();def R_a = oB ?: Zov;"$R_a/"}{"Videos/"}{def ef = ["boys' love (bl)", "gay theme", "yaoi", "yuri", "lesbian", "hentai","sex", "lgbt", "explicit", "adult animation", "adult content","nudity"];def bsp = "TheMovieDB::TV";def bH = [[ 74180, bsp],[ 93821, bsp],[ 95897, bsp],[220118, bsp],[271026, bsp]];def IQe = [[236530, bsp]];def TFq = any { info.database } { id == tmdbid ? "TheMovieDB" : "IMDb" };def ToY = TFq == "IMDb" ? "tt${id}" : id;def ZP = any { info.adult } { false };def OoZ = bH.find { it[0] == ToY && it[1] == TFq } != null;def oAr = IQe.find { it[0] == ToY && it[1] == TFq } != null;def by = info.Keywords.findAll { it in ef } || OoZ || ZP;by = oAr ? false : by;by ? "R18+ " : ""}{def Md_ = ["CN", "JP", "KR", "KP", "TW", "HK"];def La = ["aeni", "donghua", "anime"];def cAm = any {anime} || info.Keywords.findAll { it in La } || (Md_.contains(country) && genres =~ /Animation/);cAm ? "Anime/" : "TV Series/"}{def bsp = "TheMovieDB::TV";def cK = [[MZG: 68854, bw: "From Me to You", SL: bsp],[MZG: 219816, bw: "Fate/Grand Order: Fujimaru Ritsuka Doesn't Get It", SL: bsp],[MZG: 245561, bw: "Okitsura", SL: bsp],[MZG: 248707, bw: "Neko Oji The Guy That Got Reincarnated As a Cat", SL: bsp],[MZG: 259559, bw: "Headhunted to Another World", SL: bsp],[MZG: 261301, bw: "Botsuraku Kizoku", SL: bsp],[MZG: 262141, bw: "Can You Keep a Secret", SL: bsp],[MZG: 270657, bw: "Tono to Inu", SL: bsp],[MZG: 276204, bw: "Bogus Skill Fruitmaster", SL: bsp]];def TFq = any { info.database } { id == tmdbid ? "TheMovieDB" : "IMDb" };def ToY = TFq == "IMDb" ? "tt${id}" : id;def NF = n;cK.each {if (it.MZG == ToY && it.SL == TFq) {NF = it.bw}};def pC = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def MD = NF.replaceAll(pC.collect { "\\" + it }.join('|'), '');MD = MD.replaceAll(/(\s|\.)*$/, '');MD}{def bsp = "TheMovieDB::TV";def nI = [[ 95897, bsp],[123542, bsp],[235973, bsp],[239779, bsp],[257162, bsp],[259140, bsp],[276204, bsp]];def CI = nI.find { it[0] == id && it[1] == info.database } != null;def hpB = ["TheMovieDB::TV": "tmdbid","AniDB": "anidbid","TheTVDB": "tvdbid","TVmaze": "tvmazeid"];def NMW = hpB[info.database];CI ? " ($y) [${NMW}-${id}]" : ""}{"/"}{episode.special ? 'Specials' : 'Season '+s}{def pC = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def MD = sn.replaceAll(pC.collect { "\\" + it }.join('|'), '_');def Ybj = n.replaceAll(pC.collect { "\\" + it }.join('|'), '_');def Mqq = MD.contains(Ybj) ? "" : MD;Mqq == 'Season '+ s ? "" : Mqq ? " - " + Mqq : ""}{"/"}{def Jl = ["Alqanime","BlackLuster","Kuramanime","NanDesuKa","ToonsHub","Tsundere-Raws","Samehadaku"];def Ozc = Jl.find { vJx ->  fn.lower().contains(vJx.lower()) } ?: "";def gj = any {(fn =~ /^\[(.*?)\]/)[0][1]} {Ozc} {group} {""};gj ? "[$gj] " : ""}{def bsp = "TheMovieDB::TV";def cK = [[MZG: 68854, bw: "From Me to You", SL: bsp],[MZG: 219816, bw: "Fate/Grand Order: Fujimaru Ritsuka Doesn't Get It", SL: bsp],[MZG: 245561, bw: "Okitsura", SL: bsp],[MZG: 248707, bw: "Neko Oji The Guy That Got Reincarnated As a Cat", SL: bsp],[MZG: 259559, bw: "Headhunted to Another World", SL: bsp],[MZG: 261301, bw: "Botsuraku Kizoku", SL: bsp],[MZG: 262141, bw: "Can You Keep a Secret", SL: bsp],[MZG: 270657, bw: "Tono to Inu", SL: bsp],[MZG: 276204, bw: "Bogus Skill Fruitmaster", SL: bsp]];def TFq = any { info.database } { id == tmdbid ? "TheMovieDB" : "IMDb" };def ToY = TFq == "IMDb" ? "tt${id}" : id;def NF = n;cK.each {if (it.MZG == ToY && it.SL == TFq) {NF = it.bw}};def pC = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def MD = NF.replaceAll(pC.collect { "\\" + it }.join('|'), '');MD = MD.replaceAll(/(\s|\.)*$/, '');MD}{" - "}{s00e00}{def pC = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def MD = t.replaceAll(pC.collect { "\\" + it }.join('|'), '_');MD = MD.length() > 100 ? " " : " - $MD ";def bv = any { e } { special };def Aa = "Episode $bv";def ISL = MD.contains(Aa) ? '' : MD;ISL != '' ? ISL : ''}{" ["}{def Jh = [["ABEMA"],["ADN"],["BBC"],["BILI", "B-Global", "BiliIntl", "B-Site", "BiliCN"],["BOOKCUBE"],["COOLMIC"],["HIDIVE", "HIDI.WEB-DL"],["IQIYI", "IQ.WEB-DL"],["JFFP"],["LAFTEL", "LFTL"],["MDON", "MANGADON"],["MW.WEB-DL"],["NF.WEB-DL", "NF WEB"],["SHAHID"],["TVER"],["UNEXT"],["WETV"],["YTB", "YT.WEB-DL", "YOUTUBE"]];def Qq = ["ASW", "Judas", "JRx7", "EMBER", "KawaSubs", "GuodongSubs", "SAMEHADAKU"];def Pc = ["Erai-raws", "SubsPlease"];def kSS = any {(fn =~ /^\[(.*?)\]/)[0][1]} {""};def bW = any {def om = Jh.find { rwa ->  rwa.find { Euu ->  fn.lower().contains(Euu.lower()) } }[0];om = om.replace(".WEB-DL", "");om ? "${om}.WEB-DL" : ""} {source} {Qq.find { W_ ->  group == W_ || kSS == W_ } ? "WEBRip" : ""} {def kyS = Pc.find { yI ->  group == yI || kSS == yI} ? "WEB-DL" : "";(source == "Erai-raws" && vcf.upper() == "HEVC") ? "WEBRip" : kyS} {vs} {""};bW ? "$bW " : ""}{def Ik = bitdepth ? " ${bitdepth}bit" : "";"$resolution $vcf $Ik, $ac"}{" "}{af.format(8: 'DD+ 7.1',7: '6.1',6: 'DD 5.1',5: '5.0',3: '2.1',2: '2.0',1: '1.0')}{def wXe = " Dub";def ONt = audioLanguages.any { it.ISO3B == language.ISO3B } ? "" : wXe;ONt = audioLanguages.size() == 1 && audioLanguages.any { it.ISO3B == "und" } ? "" : ONt;ONt}{def XFS = any { audioLanguages.size() } { 0 };def ONt = XFS > 2 ? " MAud" : XFS > 1 ? " DAud" : null;def cGc = XFS > 5 ? audioLanguages.take(5) : audioLanguages;ONt ? ONt + cGc.joining(" ", " (", "").upper() + (XFS > 5 ? " ...)" : ")") : ""}{def rW = any { textLanguages.size() } { 0 };def ONt = rW > 2 ? ", MSub" : rW > 1 ? ", DSub" : null;def cGc = rW > 5 ? textLanguages.take(5) : textLanguages;ONt ? ONt + cGc.joining(" ", " (", "").upper() + (rW > 5 ? " ...)" : ")") : ""}{"]["}{crc32.upper()}{"]"}{if (f.subtitle) {def ZeK = ["name": "." + lang.name,"iso3b": "." + lang.ISO3B,"iso3": "." +lang.ISO3,"iso2": "." + lang.ISO2];def EX = subt;ZeK.values().each { Rt -> if (EX.contains(Rt)) {EX = EX.replace(Rt, "")}};ZeK.iso3b + EX}}{f.image ? "-thumb" : ""}