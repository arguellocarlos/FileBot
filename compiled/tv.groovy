{def kva = { System.getProperty(it) };def cMd = kva("os.name").toLowerCase().contains("windows");def yxo = kva("user.name");def YA = "/run/media/${yxo}";def bs = cMd ? "H:/" : "$YA/Videos";def Nlo = [[u_v: "Books", NcA: "F:/", RI: "$YA/Books"],[u_v: "Data", NcA: "D:/", RI: "$YA/Data"],[u_v: "Games", NcA: "G:/", RI: "$YA/Games"],[u_v: "Music", NcA: "E:/", RI: "$YA/Music"],[u_v: "Videos", NcA: "H:/", RI: "$YA/Videos"]];def JF = (Nlo.collect { it[cMd ? "NcA" : "RI"] as File }.sort { xTA, Bk ->  xTA.exists() <=> Bk.exists() ?: xTA.diskSpace <=> Bk.diskSpace }).last();def Dlr = bs ?: JF;"$Dlr/"}{"Videos/"}{def jI = ["boys' love (bl)", "gay theme", "yaoi", "yuri", "lesbian", "hentai","sex", "lgbt", "explicit", "adult animation", "adult content","nudity"];def EK = "TheMovieDB::TV";def Cv = [[ 74180, EK],[ 93821, EK],[ 95897, EK],[220118, EK],[271026, EK]];def MY = [[236530, EK]];def ErV = any { info.database } { id == tmdbid ? "TheMovieDB" : "IMDb" };def WB = ErV == "IMDb" ? "tt${id}" : id;def uDp = any { info.adult } { false };def qv = Cv.find { it[0] == WB && it[1] == ErV } != null;def na = MY.find { it[0] == WB && it[1] == ErV } != null;def xx = info.Keywords.findAll { it in jI } || qv || uDp;xx = na ? false : xx;xx ? "R18+ " : ""}{def aKN = ["CN", "JP", "KR", "KP", "TW", "HK"];def PV = ["aeni", "donghua", "anime"];def Uq = any {anime} || info.Keywords.findAll { it in PV } || (aKN.contains(country) && genres =~ /Animation/);Uq ? "Anime/" : "TV Series/"}{def EK = "TheMovieDB::TV";def Ee = [[Br: 68854, RjI: "From Me to You", rl: EK],[Br: 219816, RjI: "Fate Grand Order Fujimaru Ritsuka Doesn't Get It", rl: EK],[Br: 245561, RjI: "Okitsura", rl: EK],[Br: 248707, RjI: "Neko Oji The Guy That Got Reincarnated As a Cat", rl: EK],[Br: 259559, RjI: "Headhunted to Another World", rl: EK],[Br: 261301, RjI: "Botsuraku Kizoku", rl: EK],[Br: 262141, RjI: "Can You Keep a Secret", rl: EK],[Br: 270657, RjI: "Tono to Inu", rl: EK],[Br: 276204, RjI: "Bogus Skill Fruitmaster", rl: EK]];def ErV = any { info.database } { id == tmdbid ? "TheMovieDB" : "IMDb" };def WB = ErV == "IMDb" ? "tt${id}" : id;def zVs = n;Ee.each {if (it.Br == WB && it.rl == ErV) {zVs = it.RjI}};def le = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def b_ = zVs.replaceAll(le.collect { "\\" + it }.join('|'), '');b_ = b_.replaceAll(/(\s|\.)*$/, '');b_}{def EK = "TheMovieDB::TV";def BF = [[ 95897, EK],[123542, EK],[235973, EK],[239779, EK],[257162, EK],[259140, EK],[276204, EK]];def _L = BF.find { it[0] == id && it[1] == info.database } != null;def bn = ["TheMovieDB::TV": "tmdbid","AniDB": "anidbid","TheTVDB": "tvdbid","TVmaze": "tvmazeid"];def CvG = bn[info.database];_L ? " ($y) [${CvG}-${id}]" : ""}{"/"}{episode.special ? 'Specials' : 'Season '+s}{def le = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def b_ = sn.replaceAll(le.collect { "\\" + it }.join('|'), '_');def rO = n.replaceAll(le.collect { "\\" + it }.join('|'), '_');def jFF = b_.contains(rO) ? "" : b_;jFF == 'Season '+ s ? "" : jFF ? " - " + jFF : ""}{"/"}{def uig = ["Alqanime","BlackLuster","Kuramanime","NanDesuKa","ToonsHub","Tsundere-Raws","S1PH3R","Samehadaku"];def QZ = uig.find { RY ->  fn.lower().contains(RY.lower()) } ?: "";def Zjw = any {(fn =~ /^\[(.*?)\]/)[0][1]} {QZ} {group} {""};Zjw ? "[$Zjw] " : ""}{def EK = "TheMovieDB::TV";def Ee = [[Br: 68854, RjI: "From Me to You", rl: EK],[Br: 219816, RjI: "Fate Grand Order Fujimaru Ritsuka Doesn't Get It", rl: EK],[Br: 245561, RjI: "Okitsura", rl: EK],[Br: 248707, RjI: "Neko Oji The Guy That Got Reincarnated As a Cat", rl: EK],[Br: 259559, RjI: "Headhunted to Another World", rl: EK],[Br: 261301, RjI: "Botsuraku Kizoku", rl: EK],[Br: 262141, RjI: "Can You Keep a Secret", rl: EK],[Br: 270657, RjI: "Tono to Inu", rl: EK],[Br: 276204, RjI: "Bogus Skill Fruitmaster", rl: EK]];def ErV = any { info.database } { id == tmdbid ? "TheMovieDB" : "IMDb" };def WB = ErV == "IMDb" ? "tt${id}" : id;def zVs = n;Ee.each {if (it.Br == WB && it.rl == ErV) {zVs = it.RjI}};def le = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def b_ = zVs.replaceAll(le.collect { "\\" + it }.join('|'), '');b_ = b_.replaceAll(/(\s|\.)*$/, '');b_}{" - "}{s00e00}{def le = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def b_ = t.replaceAll(le.collect { "\\" + it }.join('|'), '_');b_ = b_.length() > 100 ? " " : " - $b_ ";def qzg = any { e } { special };def Rmb = "Episode $qzg";def Wk = b_.contains(Rmb) ? '' : b_;Wk != '' ? Wk : ''}{" ["}{def bKt = [["ABEMA"],["ADN"],["BILI", "B-Global", "BiliIntl", "B-Site", "BiliCN"],["COOLMIC"],["HIDIVE", "HIDI.WEB-DL"],["IQIYI", "IQ.WEB-DL"],["JFFP"],["LAFTEL", "LFTL"],["MDON", "MANGADON"],["MW.WEB-DL"],["NF.WEB-DL", "NF WEB"],["SHAHID"],["TVER"],["UNEXT"],["WETV"],["YTB", "YT.WEB-DL", "YOUTUBE"]];def nVG = ["ASW", "Judas", "JRx7", "EMBER", "GuodongSubs", "SAMEHADAKU"];def vt = ["Erai-raws", "SubsPlease"];def pd = any {(fn =~ /^\[(.*?)\]/)[0][1]} {""};def ZO = any {def yeE = bKt.find { qi ->  qi.find { YB ->  fn.lower().contains(YB.lower()) } }[0];yeE = yeE.replace(".WEB-DL", "");if (fn.contains("WEBRip")) {yeE = yeE.replace(".WEBRip", "");yeE = yeE + ".WEBRip"} else {yeE = yeE + ".WEB-DL"};yeE} {source} {nVG.find { OjI ->  group == OjI || pd == OjI } ? "WEBRip" : ""} {def tMd = vt.find { JA ->  group == JA || pd == JA} ? "WEB-DL" : "";(source == "Erai-raws" && vcf.upper() == "HEVC") ? "WEBRip" : tMd} {vs} {""};ZO ? "$ZO " : ""}{def UF = bitdepth ? " ${bitdepth}bit" : "";"$resolution $vcf $UF, $ac"}{" "}{af.format(8: 'DD+ 7.1',7: '6.1',6: 'DD 5.1',5: '5.0',3: '2.1',2: '2.0',1: '1.0')}{def Gf = " Dub";def gr = audioLanguages.any { it.ISO3B == language.ISO3B } ? "" : Gf;gr = audioLanguages.size() == 1 && audioLanguages.any { it.ISO3B == "und" } ? "" : gr;gr}{def mla = any { audioLanguages.size() } { 0 };def gr = mla > 2 ? " MAud" : mla > 1 ? " DAud" : null;def srt = mla > 5 ? audioLanguages.take(5) : audioLanguages;gr ? gr + srt.joining(" ", " (", "").upper() + (mla > 5 ? " ...)" : ")") : ""}{def uxD = any { textLanguages.size() } { 0 };def gr = uxD > 2 ? ", MSub" : uxD > 1 ? ", DSub" : null;def srt = uxD > 5 ? textLanguages.take(5) : textLanguages;gr ? gr + srt.joining(" ", " (", "").upper() + (uxD > 5 ? " ...)" : ")") : ""}{"]["}{crc32.upper()}{"]"}{if (f.subtitle) {def uGn = ["name": "." + lang.name,"iso3b": "." + lang.ISO3B,"iso3": "." +lang.ISO3,"iso2": "." + lang.ISO2];def tbl = subt;uGn.values().each { MJ -> if (tbl.contains(MJ)) {tbl = tbl.replace(MJ, "")}};uGn.iso3b + tbl}}{f.image ? "-thumb" : ""}