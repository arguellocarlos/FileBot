{def Dz = { System.getProperty(it) };def SLC = Dz("os.name").toLowerCase().contains("windows");def Hu = Dz("user.name");def Tj = "/run/media/${Hu}";def ID = SLC ? "H:/" : "$Tj/Videos";def Fe = [[uN: "Books", jv: "F:/", poH: "$Tj/Books"],[uN: "Data", jv: "D:/", poH: "$Tj/Data"],[uN: "Games", jv: "G:/", poH: "$Tj/Games"],[uN: "Music", jv: "E:/", poH: "$Tj/Music"],[uN: "Videos", jv: "H:/", poH: "$Tj/Videos"]];def Xw = (Fe.collect { it[SLC ? "jv" : "poH"] as File }.sort { aMG, NHJ ->  aMG.exists() <=> NHJ.exists() ?: aMG.diskSpace <=> NHJ.diskSpace }).last();def WOx = ID ?: Xw;"$WOx/"}{"Videos/"}{def oz = ["boys' love (bl)", "gay theme", "yaoi", "yuri", "lesbian", "hentai","sex", "lgbt", "explicit", "adult animation", "adult content","nudity"];def uc = "TheMovieDB::TV";def VJK = [[ 74180, uc],[ 93821, uc],[ 95897, uc],[220118, uc],[271026, uc]];def _Fs = [[236530, uc]];def nq = any { info.database } { id == tmdbid ? "TheMovieDB" : "IMDb" };def dyD = nq == "IMDb" ? "tt${id}" : id;def PQI = any { info.adult } { false };def RqL = VJK.find { it[0] == dyD && it[1] == nq } != null;def hm = _Fs.find { it[0] == dyD && it[1] == nq } != null;def mA = info.Keywords.findAll { it in oz } || RqL || PQI;mA = hm ? false : mA;mA ? "R18+ " : ""}{def DHl = ["CN", "JP", "KR", "KP", "TW", "HK"];def Al = ["aeni", "donghua", "anime"];def pbM = any {anime} || info.Keywords.findAll { it in Al } || (DHl.contains(country) && genres =~ /Animation/);pbM ? "Anime Movies/" : "Movies/"}{def uc = "TheMovieDB::TV";def oQw = [[FE: 68854, eGx: "From Me to You", FiR: uc],[FE: 219816, eGx: "Fate Grand Order Fujimaru Ritsuka Doesn't Get It", FiR: uc],[FE: 245561, eGx: "Okitsura", FiR: uc],[FE: 248707, eGx: "Neko Oji The Guy That Got Reincarnated As a Cat", FiR: uc],[FE: 259559, eGx: "Headhunted to Another World", FiR: uc],[FE: 261301, eGx: "Botsuraku Kizoku", FiR: uc],[FE: 262141, eGx: "Can You Keep a Secret", FiR: uc],[FE: 270657, eGx: "Tono to Inu", FiR: uc],[FE: 276204, eGx: "Bogus Skill Fruitmaster", FiR: uc]];def nq = any { info.database } { id == tmdbid ? "TheMovieDB" : "IMDb" };def dyD = nq == "IMDb" ? "tt${id}" : id;def hC = n;oQw.each {if (it.FE == dyD && it.FiR == nq) {hC = it.eGx}};def Ngc = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def An = hC.replaceAll(Ngc.collect { "\\" + it }.join('|'), '');An = An.replaceAll(/(\s|\.)*$/, '');An}{" ("}{y}{")"}{"/"}{def OgJ = ["Alqanime","BlackLuster","darkflux","Kuramanime","NanDesuKa","ToonsHub","Tsundere-Raws","S1PH3R","Samehadaku"];def Qu = OgJ.find { oJ ->  fn.lower().contains(oJ.lower()) } ?: "";def JDL = any {(fn =~ /^\[(.*?)\]/)[0][1]} {Qu} {group} {""};JDL ? "[$JDL] " : ""}{def uc = "TheMovieDB::TV";def oQw = [[FE: 68854, eGx: "From Me to You", FiR: uc],[FE: 219816, eGx: "Fate Grand Order Fujimaru Ritsuka Doesn't Get It", FiR: uc],[FE: 245561, eGx: "Okitsura", FiR: uc],[FE: 248707, eGx: "Neko Oji The Guy That Got Reincarnated As a Cat", FiR: uc],[FE: 259559, eGx: "Headhunted to Another World", FiR: uc],[FE: 261301, eGx: "Botsuraku Kizoku", FiR: uc],[FE: 262141, eGx: "Can You Keep a Secret", FiR: uc],[FE: 270657, eGx: "Tono to Inu", FiR: uc],[FE: 276204, eGx: "Bogus Skill Fruitmaster", FiR: uc]];def nq = any { info.database } { id == tmdbid ? "TheMovieDB" : "IMDb" };def dyD = nq == "IMDb" ? "tt${id}" : id;def hC = n;oQw.each {if (it.FE == dyD && it.FiR == nq) {hC = it.eGx}};def Ngc = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def An = hC.replaceAll(Ngc.collect { "\\" + it }.join('|'), '');An = An.replaceAll(/(\s|\.)*$/, '');An}{" ("}{y}{")"}{" ["}{def xfu = [["ABEMA"],["ADN"],["BILI", "B-Global", "BiliIntl", "B-Site", "BiliCN"],["COOLMIC"],["HIDIVE", "HIDI.WEB-DL"],["IQIYI", "IQ.WEB-DL"],["JFFP"],["LAFTEL", "LFTL"],["MDON", "MANGADON"],["MW.WEB-DL"],["NF.WEB-DL", "NF WEB"],["SHAHID"],["TVER"],["UNEXT"],["WETV"],["YTB", "YT.WEB-DL", "YOUTUBE"]];def zj = ["ASW", "Judas", "JRx7", "EMBER", "GuodongSubs", "SAMEHADAKU"];def eK = ["Erai-raws", "SubsPlease"];def Ti = any {(fn =~ /^\[(.*?)\]/)[0][1]} {""};def maB = any {def Vac = xfu.find { rhT ->  rhT.find { yN ->  fn.lower().contains(yN.lower()) } }[0];Vac = Vac.replace(".WEB-DL", "");if (fn.contains("WEBRip")) {Vac = Vac.replace(".WEBRip", "");Vac = Vac + ".WEBRip"} else {Vac = Vac + ".WEB-DL"};Vac} {source} {zj.find { on ->  group == on || Ti == on } ? "WEBRip" : ""} {def Jo = eK.find { DDI ->  group == DDI || Ti == DDI} ? "WEB-DL" : "";(source == "Erai-raws" && vcf.upper() == "HEVC") ? "WEBRip" : Jo} {vs} {""};maB ? "$maB " : ""}{def JJB = bitdepth ? " ${bitdepth}bit" : "";"$resolution $vcf $JJB, $ac"}{" "}{af.format(8: 'DD+ 7.1',7: '6.1',6: 'DD 5.1',5: '5.0',3: '2.1',2: '2.0',1: '1.0')}{def Oqb = " Dub";def BpR = audioLanguages.any { it.ISO3B == language.ISO3B } ? "" : Oqb;BpR = audioLanguages.size() == 1 && audioLanguages.any { it.ISO3B == "und" } ? "" : BpR;BpR}{def LC = any { audioLanguages.size() } { 0 };def BpR = LC > 2 ? " MAud" : LC > 1 ? " DAud" : null;def HY = LC > 5 ? audioLanguages.take(5) : audioLanguages;BpR ? BpR + HY.joining(" ", " (", "").upper() + (LC > 5 ? " ...)" : ")") : ""}{def _ek = any { textLanguages.size() } { 0 };def BpR = _ek > 2 ? ", MSub" : _ek > 1 ? ", DSub" : null;def HY = _ek > 5 ? textLanguages.take(5) : textLanguages;BpR ? BpR + HY.joining(" ", " (", "").upper() + (_ek > 5 ? " ...)" : ")") : ""}{"]["}{crc32.upper()}{"]"}{if (f.subtitle) {def ruW = ["name": "." + lang.name,"iso3b": "." + lang.ISO3B,"iso3": "." +lang.ISO3,"iso2": "." + lang.ISO2];def CKD = subt;ruW.values().each { Xy -> if (CKD.contains(Xy)) {CKD = CKD.replace(Xy, "")}};ruW.iso3b + CKD}}{f.image ? "-thumb" : ""}