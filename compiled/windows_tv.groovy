{def Fv = "H:/";def fI = [home,"D:/","E:/","F:/","G:/","H:/"].collect { it as File }.sort { CE, BYa ->  CE.exists() <=> BYa.exists() ?: CE.diskSpace <=> BYa.diskSpace }.last();def rd = Fv ? Fv : fI;"$rd/"}{"Videos/"}{def pGC = ["boys' love (bl)", "gay theme", "yaoi", "yuri", "lesbian", "hentai","sex", "lgbt", "explicit", "adult animation", "adult content"];def Pk = "TheMovieDB::TV";def Wc = [[271026, Pk],[220118, Pk],[ 74180, Pk]];def zE = [[236530, Pk]];def cl = any { info.database } { id == tmdbid ? "TheMovieDB" : "IMDb" };def ow = cl == "IMDb" ? "tt${id}" : id;def pz = any { info.adult } { false };def AD_ = Wc.find { it[0] == ow && it[1] == cl } != null;def aRr = zE.find { it[0] == ow && it[1] == cl } != null;def MMM = info.Keywords.findAll { it in pGC } || AD_ || pz;MMM = aRr ? false : MMM;MMM ? "R18+ " : ""}{def uuw = ["CN", "JP", "KR", "KP", "TW", "HK"];def NhA = ["aeni", "donghua", "anime"];def jw = any {anime} || info.Keywords.findAll { it in NhA } || (uuw.contains(country) && genres =~ /Animation/);jw ? "Anime/" : "TV Series/"}{def Pk = "TheMovieDB::TV";def En = [[Bd: 68854, AsH: "From Me to You", YwE: Pk],[Bd: 94904, AsH: "My Next Life as a Villainess", YwE: Pk],[Bd: 229743, AsH: "VTuber Legend", YwE: Pk],[Bd: 234538, AsH: "Demon Lord 2099", YwE: Pk],[Bd: 237045, AsH: "Cherry Magic!", YwE: Pk],[Bd: 240633, AsH: "A Journey Through Another World", YwE: Pk],[Bd: 245285, AsH: "Failure Frame", YwE: Pk],[Bd: 271026, AsH: "Taisho Era Contract Marriage", YwE: Pk]];def cl = any { info.database } { id == tmdbid ? "TheMovieDB" : "IMDb" };def ow = cl == "IMDb" ? "tt${id}" : id;def nIW = n;En.each {if (it.Bd == ow && it.YwE == cl) {nIW = it.AsH}};def fA = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def Ydz = nIW.replaceAll(fA.collect { "\\" + it }.join('|'), '');Ydz = Ydz.replaceAll(/(\s|\.)*$/, '');Ydz}{def Pk = "TheMovieDB::TV";def CI = [[ 68854, Pk],[123542, Pk],[204098, Pk],[235973, Pk],[239779, Pk],[240125, Pk],[257162, Pk],[259140, Pk],[262295, Pk],[271026, Pk],[273190, Pk],[275695, Pk]];def iHL = CI.find { it[0] == id && it[1] == info.database } != null;def ZVI = ["TheMovieDB::TV": "tmdbid","AniDB": "anidbid","TheTVDB": "tvdbid","TVmaze": "tvmazeid"];def ep = ZVI[info.database];iHL ? " ($y) [${ep}-${id}]" : ""}{"/"}{episode.special ? 'Specials' : 'Season '+s}{def fA = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def Ydz = sn.replaceAll(fA.collect { "\\" + it }.join('|'), '_');def NFc = n.replaceAll(fA.collect { "\\" + it }.join('|'), '_');def Obl = Ydz.contains(NFc) ? "" : Ydz;Obl == 'Season '+ s ? "" : Obl ? " - " + Obl : ""}{"/"}{def ck = ["Alqanime","BlackLuster","NanDesuKa","ToonsHub","Tsundere-Raws"];def ex = ck.find { kz ->  fn.contains(kz) } ?: "";def wA = any {(fn =~ /^\[(.*?)\]/)[0][1]} {ex} {group} {""};wA ? "[$wA] " : ""}{def Pk = "TheMovieDB::TV";def En = [[Bd: 68854, AsH: "From Me to You", YwE: Pk],[Bd: 94904, AsH: "My Next Life as a Villainess", YwE: Pk],[Bd: 229743, AsH: "VTuber Legend", YwE: Pk],[Bd: 234538, AsH: "Demon Lord 2099", YwE: Pk],[Bd: 237045, AsH: "Cherry Magic!", YwE: Pk],[Bd: 240633, AsH: "A Journey Through Another World", YwE: Pk],[Bd: 245285, AsH: "Failure Frame", YwE: Pk],[Bd: 271026, AsH: "Taisho Era Contract Marriage", YwE: Pk]];def cl = any { info.database } { id == tmdbid ? "TheMovieDB" : "IMDb" };def ow = cl == "IMDb" ? "tt${id}" : id;def nIW = n;En.each {if (it.Bd == ow && it.YwE == cl) {nIW = it.AsH}};def fA = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def Ydz = nIW.replaceAll(fA.collect { "\\" + it }.join('|'), '');Ydz = Ydz.replaceAll(/(\s|\.)*$/, '');Ydz}{" - "}{s00e00}{def fA = ['\\', '/', ':', '*', '?', '"', '<', '>', '|'];def Ydz = t.replaceAll(fA.collect { "\\" + it }.join('|'), '_');def jB = any { e } { special };Ydz = Ydz.length() > 100 ? " " : " - $Ydz ";Ydz == " - Episode $jB " ? " " : Ydz}{" ["}{def nNV = [[cA: "ABEMA", Uz: ["ABEMA"]],[cA: "Bilibili.tv", Uz: ["BILI", "B-Global", "BiliIntl", "B-Site", "BiliCN"]],[cA: "Hulu", Uz: ["HULU"]],[cA: "iQIYI", Uz: ["IQ.WEB-DL", "IQIYI"]],[cA: "Laftel.tv", Uz: ["LAFTEL", "LFTL"]],[cA: "MeWatch", Uz: ["MW.WEB-DL"]],[cA: "Netflix", Uz: ["NF.WEB-DL", "NF WEB"]],[cA: "Prime Video", Uz: ["AMZN"]],[cA: "Shahid", Uz: ["SHAHID"]],[cA: "TVer", Uz: ["TVER"]],[cA: "U-NEXT", Uz: ["UNEXT"]],[cA: "YouTube", Uz: ["YT.WEB-DL", "YOUTUBE", "YTB"]]];def SDW = ["ASW", "Judas", "JRx7", "EMBER", "KawaSubs", "GuodongSubs"];def njk = ["Erai-raws", "SubsPlease"];def LDY = any {(fn =~ /^\[(.*?)\]/)[0][1]} {""};def EPE = any {def dy = nNV.find { Dup ->  Dup.Uz.find { gGG ->  fn.contains(gGG) } }?.Uz.CE() ?: "";dy = dy.replace(".WEB-DL", "");dy ? "${dy}.WEB-DL" : ""} {source} {SDW.find { BS ->  group == BS || LDY == BS } ? "WEBRip" : ""} {def nNR = njk.find { hi ->  group == hi || LDY == hi} ? "WEB-DL" : "";(source == "Erai-raws" && vcf.upper() == "HEVC") ? "WEBRip" : nNR} {vs} {""};EPE ? "$EPE " : ""}{def zw = bitdepth ? " ${bitdepth}bit" : "";"$resolution $vcf $zw, $ac"}{" "}{af.format(8: 'DD+ 7.1',7: '6.1',6: 'DD 5.1',5: '5.0',3: '2.1',2: '2.0',1: '1.0')}{def pCZ = " Dub";def xmn = audioLanguages.any { it.ISO3B == language.ISO3B } ? "" : pCZ;xmn = audioLanguages.size() == 1 && audioLanguages.any { it.ISO3B == "und" } ? "" : xmn;xmn}{def VZ = any { audioLanguages.size() } { 0 };def xmn = VZ > 2 ? " MAud" : VZ > 1 ? " DAud" : null;def GKd = VZ > 5 ? audioLanguages.take(5) : audioLanguages;xmn ? xmn + GKd.joining(" ", " (", "").upper() + (VZ > 5 ? " ...)" : ")") : ""}{def RzK = any { textLanguages.size() } { 0 };def xmn = RzK > 2 ? ", MSub" : RzK > 1 ? ", DSub" : null;def GKd = RzK > 5 ? textLanguages.take(5) : textLanguages;xmn ? xmn + GKd.joining(" ", " (", "").upper() + (RzK > 5 ? " ...)" : ")") : ""}{"]["}{crc32.upper()}{"]"}{def yw = ["name": "." + lang.name,"iso3b": "." + lang.ISO3B,"iso3": "." +lang.ISO3,"iso2": "." + lang.ISO2];def AS = subt;yw.values().each { scC -> if (AS.contains(scC)) {AS = AS.replace(scC, "")}};f.subtitle ? yw.iso3b + AS : ""}{f.image ? "-thumb" : ""}